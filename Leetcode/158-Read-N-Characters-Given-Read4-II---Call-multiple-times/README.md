
Use a queue to record how many chars remained in the buffer.   

Well, I still do not understand what is the difference between API getting called multiple times and one single time per file, or per test case.....

